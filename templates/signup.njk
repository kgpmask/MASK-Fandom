{% extends "_base.njk" %}

{% set thispage = 'signup' %}
{% set pagetitle = 'Signup' %}

{% set sauces = [
	{ name: 'Attack On Titan', id: 'AOT' },
	{ name: 'Naruto', id: 'NRT' },
	{ name: 'One Punch Man', id: 'OPM' },
	{ name: 'My Hero Academia', id: 'MHA' }
] %}

{% block pagecontent %}
	<h1>Signup</h3>
	<div class="form-container">
		<form action='/' method='post' id="signup">
			<div id="page1" style="display:block;">
				<input type= "text" placeholder="Display name" id="display-name">
				<input type="email" placeholder="E-mail address" id="email">
				<hr style="width: 80%; border: solid 1px var(--off-white); margin: 15px 10% 5px;">
				<p style="padding-top: 9px;font-size: 130%;">Select your profile picture</p>
				<div id="images">
					{% for char, image in images %}
						<img src="{{ image.src }}" alt="{{ char }}" id="img-{{ char }}">
					{% endfor %}
				</div>
				<hr style="width: 80%; border: solid 1px var(--off-white); margin: 15px 10% 5px;">
				<p style="padding-top: 9px;font-size: 130%;">Select the anime you want to register for</p>
				<div class="checkbox_container">
					{% for sauce in sauces %}
					<div class="checkbox-holder">
						<input type="checkbox" class="quiz" id="{{ sauce.id }}">
						<label for="{{ sauce.id }}">{{ sauce.name }}</label>
					</div>
					{% endfor %}
				</div>
				<button type="button" class="nextpage" onclick="shownextpg()">Next</button>
			</div>
			<div id="page2" style="display:none;">
				<p style="padding-top: 9px;font-size: 150%;">Authentication</p>
				<input type="text" placeholder="Username" id="username">
				<input type="password" placeholder="Password" id="password">
				<input type="password" placeholder="Confirm Password" id="confirm-password">
				<button type="button" class="prev" onclick="showprevpg()">Previous</button>
				<button type="button" class="nextpage" onclick="shownextpg()">Next</button>
			</div>
			<div id="page3" style="display:none;">
				<p style="padding-top: 9px;font-size: 150%;">Payment</p>
				<p style="padding-top: 9px;font-size: 100%;">Scan the following QR code to proceed with your payment. Fill the transaction ID in the field.</p>
				<hr style="width: 80%; border: solid 1px var(--off-white); margin: 15px 10%;">
				<img src="../assets/testqr/test.webp" id="UPI" style="border-radius: 8px;">
				<input type="text" placeholder="Transaction ID" id='transaction-ID'>
				<h4><font family="sans serif">Click on the icons below corresponding to your payment app to find the Transaction ID in sample transactions!</font></h4>
				<div class="upi_icons">
					<img src="../assets/icons/paytm.png" class="icons" height="60px" width="60px" id="paytm" onclick="displaymodal(this)">
					<img src="../assets/icons/gpay.png" class="icons" height="60px" width="60px" id="gpay" onclick="displaymodal(this)">
					<img src="../assets/icons/bhim.png" class="icons" height="60px" width="60px" id="bhim" onclick="displaymodal(this)">
					<img src="../assets/icons/phonepe.png" class="icons" height="60px" width="60px" id="phonepe" onclick="displaymodal(this)">
				</div>
				<button type="button" class="prev" onclick="showprevpg()">Previous</button>
				<button type="button" id="submit" onclick="signUp()">Submit</button>
			</div>
		</form>
			<div class="modal-container">
				<div id="modal">
					<span onclick="closemodal()" class="closespn">Ã—</span><br>
					<img class="modalImage" id="modalimg" style="scale:0.67; translate: 0% -20%;" />
				</div>
			</div>

	</div>

{% endblock %}
 
{% block customcss %}
	<style media="screen">
		.form-container{
			{# margin-top : 43rem; #}
			margin-bottom : 63rem;
			display : block;
		}
		
		form{
			display: flex;
			width: 75%;
			max-width: 540px;
			background-color: rgba(255,255,255,0.13);
			position: absolute;
			transform: translate(-50%,-50%);
			top: 50%;
			left: 50%;
			border-radius: 10px;
			backdrop-filter: blur(5px);
			border: 2px solid rgba(255,255,255,0.1);
			box-shadow: 0 0 40px rgba(8,7,16,0.6);
			padding: 12px 25px;
			row-gap: 10px;
		}
		form *{
			font-family:Ubuntu,Roboto,Arial,Open Sans,sans-serif;
			color: #ffffff;
			letter-spacing: 0.5px;
			outline: none;
			border: none;
		}
		form h3{
			font-size: 32px;
			font-weight: 500;
			line-height: 42px;
			text-align: center;
			margin-bottom:35px;
		}

		input{
			height: 50px;
			width: -moz-available;
			width: -webkit-fill-available;
			background-color: rgba(255,255,255,0.07);
			border-radius: 12px;
			padding: 0 20px 4px;
			margin-top: 12px;
			font-size: 17px;

			font-weight: 300;
		}

		.checkbox_container {
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			align-items: center;
			justify-content: center;
		}

		.checkbox-holder {
			margin: 5px 20px;
			width: 30%;
		}

		.checkboxes{
			display : inline;
			height: 10px;
		}
		::placeholder{
			color: #e5e5e5;
			font-family:Ubuntu,Roboto,Arial,Open Sans,sans-serif;
			font-size:20px;
		}
		button{
			margin-top: 19px;
			width: 44%;
			background-color: var(--red);
			color: white;
			padding: 12px 0;
			font-size: 18px;
			font-weight: 600;
			border-radius: 12px;
			cursor: pointer;
			display=inline;
			align-items:right;
			margin-right : 9px;
			margin-left : 9px;
		}

		#images{
			padding : 11px 4px 0px 0px;
		}
		.profile_picture{
			height : 82px;
			border-radius : 14px;
		}

		.profile_picture:hover{
			transform : scale(1.1);
		}

		#modal {
		display: none;
		position: fixed;
		z-index: 1;
		padding-top: 100px;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		overflow: auto;
		background-color: rgb(0, 0, 0);
		background-color: rgba(0, 0, 0, 0.9);
		}
		
		.closespn{
			position: absolute;
			translate: 2200% -128%;
			transform: scale(3);
			font-weight: bold;
		}

		.upi_icons{
			padding-top:15px;
		}
		.icons{
			padding:0px 5px;
			border-radius :20px;
		}
		
		h4{
			padding-top:12px;
		}

		.modalImage{
			border-radius:15px;
		}

		#images {
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			align-items: center;
			justify-content: center;
		}

		#images > img {
			margin: 10px;
			width: 50px;
			height: 50px;
		}

		#images > .selected-image {
			margin: 1px !important;
			border: solid 4px var(--dark-red);
			width: 60px !important;
			height: 60px !important;
		}
	</style>
{% endblock %}



{% block customjs %}
	<script>
		let currentPage = 1;
		const max = (a, b) => a > b ? a : b;
		const min = (a, b) => a < b ? a : b;
		let selectedImage;

		function shownextpg () {
			document.getElementById(`page${currentPage}`).style.display = 'none';
			currentPage = min(3, ++currentPage);
			document.getElementById(`page${currentPage}`).style.display = 'block';
		}

		function showprevpg () {
			document.getElementById(`page${currentPage}`).style.display = 'none';
			currentPage = max(1, --currentPage);
			document.getElementById(`page${currentPage}`).style.display = 'block';
		}


		function displaymodal (element) {
			document.getElementById('modalimg').src = '../assets/transactionpages/' + element.id + '.png';
			document.getElementById('modal').style.display = 'block';
		};
		
		function closemodal () {
			// console.log('close');
			document.getElementById('modal').style.display = 'none';
		}
		
		function signUp () {
			// Page one
			const name = document.getElementById('display-name').value;
			if (!name.trim()) return alert('Empty Name');
			if (name.match(/^([a-zA-Z0-9\.])+$/)) return alert('Name doesn\'t meet requirements');
			const email = document.getElementById('email').value;
			if (!email.trim()) return alert('Empty Email Address');
			const image = selectedImage;
			if (!image) return alert('Image not selected.')
			const signedUpFor = {};
			{% for sauce in sauces %}
				signedUpFor.{{ sauce.name if sauce.name == 'Naruto' else sauce.id }} = document.getElementById('{{ sauce.id }}').checked;
			{% endfor %}
			if (!Object.values(signedUpFor).some(Boolean)) return alert('Sign up for at least one quiz.');
			console.log({ name, email, image, signedUpFor })
			// Page two
			const username = document.getElementById('username').value;
			if (!username) return alert('No username given.');
			if (username.match(/^([\-\.]*?\w*)+$/)) return alert('Username doesn\'t meet requirements');
			const password = document.getElementById('password').value;
			if (!password) return alert('No password provided.');
			if (!password.match(/^(?=.*[!-~]).{6,20}$/)) {
				return alert('Password doesn\'t meet the requirements');
			}
			if (!password !== document.getElementById('confirm-password').value) return alert('Passwords do not match!');
			// Page three
			const transactionID = document.getElementById('transaction-ID').value;
			if (!transactionID) return alert('Transaction ID not provided. Signup requires transaction ID');
			console.log('Sending POST request');
			axios.post('/signup', {
				name,
				username,
				password,
				email,
				image,
				signedUpFor,
				transactionID
			}).then(() => window.location.href = '/')
			.catch(e => console.log(e));
		}

		window.onload = () => {
			[...document.getElementById('images').children].forEach(child => child.addEventListener('click', () => {
				try {
					document.getElementById(`img-${selectedImage}`).classList.remove('selected-image');
				}
				catch (e) { console.log('Throwing error'); }
				finally {
					selectedImage = child.alt;
					document.getElementById(`img-${selectedImage}`).classList.add('selected-image');
				}
			}));
		}
	</script>
{% endblock %}
